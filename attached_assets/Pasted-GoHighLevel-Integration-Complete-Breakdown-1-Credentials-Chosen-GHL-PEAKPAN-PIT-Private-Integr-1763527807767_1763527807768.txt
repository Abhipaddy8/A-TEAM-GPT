GoHighLevel Integration - Complete Breakdown:
1. Credentials Chosen:
GHL_PEAKPAN_PIT (Private Integration Token):

pit-fd24ed74-795f-4aa7-9b10-08309d634df5

This is your Private Integration Token from GHL
Used for all API authentication
Has permissions for contacts, calendars, conversations
GHL_PEAKSPAN_LOCATION_ID2:

KM3KkAQFgG3bByTZmWLL

Your PeakSpan location ID in GoHighLevel
All contacts/emails are scoped to this location
GHL_CALENDAR_ID:

ZulfPy0UEQyAOcSnCd9l

Used for fetching appointment data
2. Email Sending Through GHL (from lib/ghlEmailSender.js):
Process Flow:

Step 1: Lookup contact by email in GHL
   â†“
Step 2: If contact doesn't exist â†’ CREATE contact automatically
   â†“
Step 3: Get contactId
   â†“
Step 4: Send email via GHL Conversations API

Implementation:

Email sent FROM: care@mail.peakspan.com.au (your verified GHL email)

API Endpoint: POST https://services.leadconnectorhq.com/conversations/messages

Email Payload:

{
  "type": "Email",
  "locationId": "KM3KkAQFgG3bByTZmWLL",
  "contactId": "<resolved-contact-id>",
  "emailFrom": "care@mail.peakspan.com.au",
  "emailTo": "patient@email.com",
  "subject": "Prescription Form Ready - Greg Wilkes",
  "html": "<full HTML email>",
  "attachments": [] // PDF attachments if needed
}

3. Contact Creation Within GHL:
Auto-Creation Logic (lines 56-81 in ghlEmailSender.js):

// Step 1: Search for contact by email
const lookupUrl = `contacts/?locationId=${locationId}&query=${email}`;
// Step 2: If NOT found, create contact
if (!contactId) {
  await fetch(`contacts/`, {
    method: "POST",
    body: JSON.stringify({
      locationId: "KM3KkAQFgG3bByTZmWLL",
      email: "patient@email.com",
      firstName: "patient", // Extracted from email
      lastName: "Contact"
    })
  });
}

Contact Fields Created:

email: Full patient email
firstName: Extracted from email prefix (e.g., "greg" from greg@...)
lastName: "Contact" (default)
locationId: KM3KkAQFgG3bByTZmWLL
Result: Every email sent automatically creates the contact in GHL if they don't already exist!

4. Why This Approach?
âœ… Automatic Contact Management: No manual contact creation needed
âœ… Email Delivery: All emails come FROM your verified GHL email (care@mail.peakspan.com.au)
âœ… CRM Integration: Every patient automatically becomes a GHL contact
âœ… Conversation History: All emails visible in GHL conversations panel
âœ… No Gmail Limits: Bypasses Gmail sending limits by using GHL's infrastructure

5. What Happens in Real Workflow (Greg Wilkes Example):
1. Fireflies webhook arrives
2. LLM extracts: "Greg Wilkes"
3. GHL search: Found existing contact (greg@developcoaching.com.au)
4. ContactID: RU4VMG2uF0UleBupxChf
5. Email sent via GHL Conversations API FROM care@mail.peakspan.com.au
6. âœ… Email delivered + visible in GHL CRM

Key Point: We're NOT creating new contacts for every webhook because most patients already exist in your GHL from appointment booking. We only auto-create if they're somehow missing.

Summary:

Credentials: PIT token + Location ID (PeakSpan)
Email sending: GHL Conversations API (FROM care@mail.peakspan.com.au)
Contact creation: Auto-creates only if contact doesn't exist
Result: Seamless email delivery with full CRM integration
Does this clarify the GHL setup? ðŸŽ¯